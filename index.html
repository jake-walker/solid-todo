<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

    <title>Solid Todo</title>
  </head>
  <body>
    <div id="app">
      <p v-if="session">Logged in as {{ session.webId }}</p>
      <button v-on:click="login()">Login</button>
    </div>


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>

    <script src="https://solid.github.io/solid-auth-client/dist/solid-auth-client.bundle.js"></script>

    <script>
      solid.auth.fetch('https://jakew.solid.community/profile/card').then(response => response.body).then(body => {
        const reader = body.getReader();
        reader.read().then(function processText({ done, value }) {
          // Result objects contain two properties:
          // done  - true if the stream has already given you all its data.
          // value - some data. Always undefined when done is true.
          if (done) {
            console.log("Stream complete");
            para.textContent = result;
            return;
          }

          charsReceived += value.length;
          const chunk = value;
          let listItem = document.createElement('li');
          listItem.textContent = 'Read ' + charsReceived + ' characters so far. Current chunk = ' + chunk;
          list2.appendChild(listItem);

          result += chunk;

          // Read some more, and call this function again
          return reader.read().then(processText);
        });
      });
      var app = new Vue({
        el: '#app',
        data: {
          message: 'Hello Vue!',
          popupUri: "popup.html",
          session: null
        },
        methods: {
          login: async function(e) {
            let session = await solid.auth.currentSession();
            let popupUri = this.$data.popupUri;
            if (!session)
              session = await solid.auth.popupLogin({ popupUri });
            alert(`Logged in as ${session.webId}`);
          }
        }
      });

      solid.auth.trackSession(session => {
        app.session = session;
      });
    </script>
  </body>
</html>